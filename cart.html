<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cart - TasteCart</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-white text-gray-800">
    <div class="max-w-6xl mx-auto px-4 py-8">
      <h1 class="text-3xl font-bold text-red-500 mb-6">Your Cart</h1>

      <div id="cartContainer" class="space-y-6"></div>

      <div id="paymentSection" class="mt-8 border-t pt-6 hidden">
        <div id="total" class="text-right font-bold text-xl mb-6"></div>

        <div class="flex flex-col items-center gap-6">
          <h2 class="text-lg font-semibold">Payment methods</h2>

          <div class="flex items-center gap-6">
            <label class="cursor-pointer">
              <input
                type="radio"
                name="payment"
                value="tap"
                class="peer hidden"
              />
              <div
                class="border-2 border-transparent peer-checked:border-blue-500 rounded p-1 transition"
              >
                <img
                  src="https://i.ibb.co/MNpFtP0/tap.png"
                  alt="tap"
                  class="w-16 h-16 object-contain"
                />
              </div>
            </label>

            <label class="cursor-pointer">
              <input
                type="radio"
                name="payment"
                value="nagad"
                class="peer hidden"
              />
              <div
                class="border-2 border-transparent peer-checked:border-blue-500 rounded p-1 transition"
              >
                <img
                  src="https://i.ibb.co/1znVNzP/nagad.png"
                  alt="nagad"
                  class="w-16 h-16 object-contain"
                />
              </div>
            </label>

            <label class="cursor-pointer">
              <input
                type="radio"
                name="payment"
                value="rocket"
                class="peer hidden"
              />
              <div
                class="border-2 border-transparent peer-checked:border-blue-500 rounded p-1 transition"
              >
                <img
                  src="https://i.ibb.co/hKsX90P/rocket.png"
                  alt="rocket"
                  class="w-16 h-16 object-contain"
                />
              </div>
            </label>
          </div>

          <div class="text-gray-500">Or</div>

          <label class="flex items-center space-x-2 text-lg cursor-pointer">
            <input
              type="radio"
              name="payment"
              value="cod"
              checked
              class="accent-blue-500"
            />
            <span>Cash on delivery</span>
          </label>

          <button
            id="checkoutBtn"
            class="bg-sky-400 text-white px-6 py-2 rounded hover:bg-sky-500 transition"
          >
            Checkout
          </button>
        </div>
      </div>

      <p
        id="emptyCartMsg"
        class="text-center text-gray-500 mt-12 hidden text-lg"
      >
        Your cart is empty.
      </p>
    </div>

    <script>
      const cartContainer = document.getElementById("cartContainer");
      const totalDiv = document.getElementById("total");
      const paymentSection = document.getElementById("paymentSection");
      const emptyCartMsg = document.getElementById("emptyCartMsg");

      document.getElementById("checkoutBtn").addEventListener("click", () => {
        const cart = JSON.parse(localStorage.getItem("tasteCartCart")) || [];
        if (!cart.length) return;

        const selectedMethod = document.querySelector(
          'input[name="payment"]:checked'
        )?.value;

        checkoutBtn.addEventListener("click", () => {
          localStorage.setItem("tasteCartOrder", JSON.stringify(cart)); // âœ… for status page
          localStorage.removeItem("tasteCartCart"); // clear cart
          window.location.href = "status.html";
        });

        if (selectedMethod === "cod") {
          cartContainer.innerHTML = `
            <div class="text-center py-12">
              <h2 class="text-2xl font-bold text-green-600 mb-4">ðŸŽ‰ Order Placed!</h2>
              <p class="text-gray-700">Thank you for ordering with TasteCart.</p>
              <p class="text-gray-500 mt-2">Youâ€™ll be redirected shortly...</p>
            </div>
          `;
          paymentSection.classList.add("hidden");

          setTimeout(() => {
            window.location.href = "status.html";
          }, 3000);
        } else {
          cartContainer.innerHTML = `
            <div class="text-center py-12">
              <h2 class="text-2xl font-bold text-blue-600 mb-4">Processing Payment...</h2>
              <p class="text-gray-700">Redirecting to ${selectedMethod.toUpperCase()} payment gateway.</p>
              <p class="text-gray-500 mt-2">Please wait...</p>
            </div>
          `;
          paymentSection.classList.add("hidden");

          setTimeout(() => {
            window.location.href = "payment.html";
          }, 3000);
        }
      });

      function loadCart() {
        const cart = JSON.parse(localStorage.getItem("tasteCartCart")) || [];
        cartContainer.innerHTML = "";
        let total = 0;

        if (!cart.length) {
          emptyCartMsg.classList.remove("hidden");
          paymentSection.classList.add("hidden");
          return;
        } else {
          emptyCartMsg.classList.add("hidden");
          paymentSection.classList.remove("hidden");
        }

        cart.forEach((item, i) => {
          total += item.price * (item.quantity || 1);
          cartContainer.innerHTML += `
            <div class="flex flex-col md:flex-row items-center justify-between gap-6 border p-4 rounded-lg shadow-md">
              <img src="${item.image}" alt="${
            item.name
          }" class="w-32 h-24 object-cover rounded">
              <div class="flex-1">
                <h2 class="font-bold text-lg">${item.name}</h2>
                <p class="text-gray-600 text-sm">${item.restaurantName}</p>
                <p class="text-red-600 font-semibold mt-1">à§³${item.price} x ${
            item.quantity || 1
          }</p>
              </div>
              <div class="flex items-center gap-2">
                <button onclick="decreaseQty(${i})" class="bg-gray-200 px-3 py-1 rounded hover:bg-gray-300">-</button>
                <span class="min-w-[24px] text-center">${
                  item.quantity || 1
                }</span>
                <button onclick="increaseQty(${i})" class="bg-gray-200 px-3 py-1 rounded hover:bg-gray-300">+</button>
              </div>
              <div class="flex flex-col gap-2 items-end">
                <button onclick="changeItem()" class="text-blue-500 hover:underline">Change</button>
                <button onclick="removeItem(${i})" class="text-red-500 hover:underline">Remove</button>
              </div>
            </div>
          `;
        });

        totalDiv.textContent = `Total: à§³${total.toFixed(2)}`;
      }

      function removeItem(index) {
        let cart = JSON.parse(localStorage.getItem("tasteCartCart")) || [];
        cart.splice(index, 1);
        localStorage.setItem("tasteCartCart", JSON.stringify(cart));
        loadCart();
      }

      function increaseQty(index) {
        let cart = JSON.parse(localStorage.getItem("tasteCartCart")) || [];
        cart[index].quantity = (cart[index].quantity || 1) + 1;
        localStorage.setItem("tasteCartCart", JSON.stringify(cart));
        loadCart();
      }

      function decreaseQty(index) {
        let cart = JSON.parse(localStorage.getItem("tasteCartCart")) || [];
        if ((cart[index].quantity || 1) > 1) {
          cart[index].quantity -= 1;
          localStorage.setItem("tasteCartCart", JSON.stringify(cart));
          loadCart();
        }
      }

      function changeItem() {
        window.location.href = "menu.html";
      }

      loadCart();
      document.getElementById("checkoutBtn").addEventListener("click", () => {
        const cart = JSON.parse(localStorage.getItem("tasteCartCart")) || [];

        // Save current cart as order for status page
        localStorage.setItem("tasteCartOrder", JSON.stringify(cart));

        // Clear cart after checkout
        localStorage.removeItem("tasteCartCart");

        // Go to order status
        window.location.href = "status.html";
      });
    </script>
  </body>
</html>
