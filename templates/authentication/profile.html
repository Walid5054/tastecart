{% extends 'kits/base.html' %} {% load static %} {% block title %}
  Profile - TasteCart
{% endblock %} {% block content %}
  <div class="min-h-screen bg-gray-50 pt-28">
    <!-- Profile Section -->
    <section class="max-w-4xl mx-auto pt-8 p-6 bg-white rounded-xl shadow mt-8">
      <div class="flex items-center space-x-6">
        <img id="profileImg"
          src="{% if user.profile.profile_image %}
            {{ user.profile.profile_image.url }}
          {% else %}
            
            
            
            
            https://via.placeholder.com/120




          {% endif %}"
          alt="Profile"
          class="w-28 h-28 rounded-full object-cover border" />
        <div>
          <h2 class="text-2xl font-semibold text-gray-800" id="userName">{{ user.name }}</h2>
          <p class="text-gray-500" id="userEmail">{{ user.email }}</p>
          {% if user.phone %}
            <p class="text-gray-500" id="userMobile">{{ user.phone }}</p>
          {% endif %}
        </div>
      </div>

      <div class="mt-6">
        <h3 class="text-xl font-semibold mb-3 text-gray-700">Delivery Address</h3>
        <div class="flex items-center space-x-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-500" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9l-4.95 4.95-4.95-4.95a7 7 0 010-9.9zM10 9a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
          </svg>
          <span id="userAddress">
            {% if user.profile.address %}
              {{ user.profile.address }}
            {% else %}
              No address added yet
            {% endif %}
          </span>
          <button onclick="openEditModal()" class="ml-auto text-sm text-red-500 hover:underline">Edit Profile</button>
        </div>
      </div>

      <!-- Bio Section -->
      {% if user.profile.bio %}
        <div class="mt-6">
          <h3 class="text-xl font-semibold mb-3 text-gray-700">Bio</h3>
          <p class="text-gray-600" id="userBio">{{ user.profile.bio }}</p>
        </div>
      {% endif %}

      <!-- Order History -->

      <div class="mt-10">
        <h3 class="text-2xl font-bold text-gray-800 mb-6">Recent Orders</h3>

        <ul class="space-y-6" id="orderHistory">
          {% for order in order_history %}
            <li class="bg-white p-6 rounded-xl shadow border border-gray-200">
              <div class="flex justify-between items-start">
                <!-- Left Section: Order Info -->
                <div class="flex-1">
                  <p class="text-sm text-gray-500">
                    Order ID: <span class="font-semibold text-gray-800">#{{ order.order.id }}</span>
                  </p>
                  <p class="text-sm text-gray-500">
                    Placed On: <span class="text-gray-700">{{ order.order.created_at|date:'M d, Y - H:i A' }}</span>
                  </p>
                  <p class="text-sm text-gray-500">
                    Status: <span class="text-gray-700 font-medium">{{ order.order.status }}</span>
                  </p>

                  <div class="mt-3">
                    <p class="text-sm text-gray-500">Restaurant:</p>
                    <p class="text-base font-semibold text-red-600">{{ order.order.cart.item.restaurant }}</p>
                  </div>
                </div>

                <!-- Right Section: Actions -->
                <div class="flex flex-col items-center space-y-3">
                  <a href="{% url 'order_status' %}" class="w-32 text-center px-4 py-2 bg-blue-600 text-white rounded-full text-sm font-medium shadow hover:bg-blue-700 transition duration-200">View Details</a>

                  <a href="{% url 'add_to_cart' order.order.cart.item.restaurant.slug order.order.cart.item.id 1 %}" class="w-32 text-sm text-white bg-green-600 hover:bg-green-700 px-4 py-2 rounded-full font-medium shadow transition duration-200 text-center" id="reorder">Reorder</a>

                  <a href="{% url 'restaurant_view' order.order.cart.item.restaurant.slug %}" class="w-32 text-sm text-white bg-yellow-500 hover:bg-yellow-600 px-4 py-2 rounded-full font-medium shadow transition duration-200 text-center">Give Review</a>
                </div>
              </div>
            </li>
          {% empty %}
            <li class="text-center text-gray-500 py-8">No recent orders found.</li>
          {% endfor %}
        </ul>

        {% if not order_history %}
          <div class="text-center py-10">
            <a href="{% url 'restaurants_view' %}" class="inline-block bg-red-500 text-white px-5 py-2 rounded-full hover:bg-red-600 transition">Start Ordering</a>
          </div>
        {% endif %}
      </div>
    </section>
  </div>

  <!-- Edit Modal -->
  <div id="editModal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center hidden z-50">
    <div class="bg-white p-6 rounded-lg w-full max-w-md space-y-4 max-h-[90vh] overflow-y-auto">
      <h3 class="text-xl font-semibold text-gray-800">Edit Profile</h3>

      <form action="{% url 'view_profile' %}" method="post" enctype="multipart/form-data">
        {% csrf_token %}

        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
            <input type="email" name="email" value="{{ user.email }}" required class="w-full border px-3 py-2 rounded focus:ring-red-400 focus:ring-2 transition" />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
            <input type="text" name="phone" value="{{ user.phone|default:'' }}" placeholder="Enter your phone number" class="w-full border px-3 py-2 rounded focus:ring-red-400 focus:ring-2 transition" />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Profile Image</label>
            <input type="file" name="profile_image" accept="image/*" class="w-full border px-3 py-2 rounded focus:ring-red-400 focus:ring-2 transition" />
            {% if user.profile.profile_image %}
              <p class="text-xs text-gray-500 mt-1">Current: {{ user.profile.profile_image.name }}</p>
            {% endif %}
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Address</label>
            <textarea name="address" placeholder="Enter your delivery address" rows="3" class="w-full border px-3 py-2 rounded focus:ring-red-400 focus:ring-2 transition">{{ user.profile.address|default:'' }}</textarea>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Bio</label>
            <textarea name="bio" placeholder="Tell us about yourself" rows="4" class="w-full border px-3 py-2 rounded focus:ring-red-400 focus:ring-2 transition">{{ user.profile.bio|default:'' }}</textarea>
          </div>
        </div>

        <div class="flex space-x-2 pt-4">
          <button type="button" onclick="closeEditModal()" class="flex-1 px-4 py-2 bg-gray-300 rounded hover:bg-gray-400 transition">Cancel</button>
          <button type="submit" class="flex-1 px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition">Save</button>
        </div>
      </form>
    </div>
  </div>
  <script>
    document.getElementById('reorder').addEventListener('click', () => {
      window.location.href = "{% url 'restaurants_view' %}"
    })
  </script>
{% endblock %}
